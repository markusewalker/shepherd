name: Create Rancher PR

# This workflow triggers on a push to the main branch. It updates the
# rancher/shepherd dependency in the rancher/rancher repository by dispatching
# a downstream workflow.
on:
  push:
    branches:
      - main-demo-branch

jobs:
  dispatch-to-rancher:
    permissions:
      # This is required to checkout the repository
      contents: read
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Dispatch 'Go get' workflow in rancher/rancher
        run: |
          echo "Dispatching to rancher/rancher on branch main for shepherd commit ${{ github.sha }}"
          gh workflow run "Go get" \
            --repo rancher/rancher \
            --ref main \
            -F goget_module=github.com/rancher/shepherd \
            -F goget_version=${{ github.sha }} \
            -F source_author=${{ github.actor }}
        env:
          GH_TOKEN: ${{ secrets.PAT_TOKEN }}